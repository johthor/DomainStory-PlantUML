' Entity Creation
' ##################################

!unquoted function Actor($kind, $icon, $name, $label = "", $tag = "", $note = "", $shape = "", $scale = "", $color = "", $background = "")
    !if $DST_PUML_ENTITY_NAMES == "dynamic" || $dynamicElementNames == "active"
        !$tmpLabel = $name
        !$name = $computeNextElementName("Actor")
        !$actorName = $createElement("Actor", $kind, $icon, $name, $tmpLabel, $label, $note, $shape, $scale, $color)
        $createElementNote($name, $tag)
    !else
        !$actorName = $createElement("Actor", $kind, $icon, $name, $label, $tag, $shape, $scale, $color, $background)
        $createElementNote($name, $note)
    !endif

    !return $actorName
!endfunction

!unquoted function Object($kind, $icon, $name, $label = "", $tag = "", $note = "", $shape = "", $scale = "", $color = "", $background = "")
    !if $DST_PUML_ENTITY_NAMES == "dynamic" || $dynamicElementNames == "active"
        !$tmpLabel = $name
        !$name = $computeNextElementName("Object")
        !$objectName = $createElement("Object", $kind, $icon, $name, $tmpLabel, $label, $note, $shape, $scale, $color)
        $createElementNote($name, $tag)
    !else
        !$objectName = $createElement("Object", $kind, $icon, $name, $label, $tag, $shape, $scale, $color, $background)
        $createElementNote($name, $note)
    !endif

    !return $objectName
!endfunction

!unquoted procedure introduce($name, $element)
    %set_variable_value($name, $element)
!endprocedure

!unquoted function $createElement($type, $kind, $icon, $name, $label = "", $tag = "", $shape = "", $scale = "", $color = "", $background = "")
    $debug($type + "(" + $kind + ", " + $icon + ") " + $name + " : " + $label + " : " + $tag + " : " + $shape + " : " + $scale + " : " + $color + " : " + $background)

    !if $label == ""
        !$label = $name
    !endif

    !$shape = $getStyleProperty($shape, $type, $kind, $tag, Shape)
    !$scale = $getStyleProperty($scale, $type, $kind, $tag, IconScale)
    !$color = $getStyleProperty($color, $type, $kind, $tag, IconColor)

    !$backgroundColor = $computeColorName($background)
    !$stereotypes = $computeStereotypes($kind, $tag)

    ' output below
    $pumlEntity($shape, $label, $name, $icon, $scale, $color, $stereotypes, $backgroundColor)

    !if $dynamicElementNames == "active"
        !return $name
    !else
        !return ""
    !endif
!endfunction

!function $computeNextElementName($type)
    !$prefix = %lower($type)
    !$counterName = "$" + $prefix + "Counter"

    !$nextValue = %get_variable_value($counterName) + 1
    %set_variable_value($counterName, $nextValue)

    !return $prefix + %string($nextValue)
!endfunction
